<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content"
    />
    <meta name="description" content="Parallel agentic development with Electron + React" />
    <meta name="theme-color" content="#0C0F1A" />
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" vite-ignore />
    <link rel="icon" href="/favicon.ico" data-theme-icon vite-ignore />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" vite-ignore />
    <title>Lattice Workbench</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: var(--color-background, #0C0F1A);
        color: var(--color-foreground, #E2E4EB);
        font-family: var(
          --font-primary,
          -apple-system,
          BlinkMacSystemFont,
          "Geist",
          system-ui,
          "Segoe UI",
          "Roboto",
          "Helvetica Neue",
          Arial,
          sans-serif,
          "Apple Color Emoji",
          "Segoe UI Emoji",
          "Segoe UI Symbol"
        );
        font-size: 14px;
      }

      :root[data-theme="light"] body {
        background: #FFFCF0;
      }

      #root {
        height: 100%;
        overflow: hidden;
      }

      /* Pre-JS placeholder to avoid a blank screen on cold start. */
      .boot-loader {
        height: 100vh; /* fallback for older browsers */
        height: 100dvh;
        width: 100vw;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .boot-loader__inner {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
      }

      /* ── Minion Eyes Awakening ─────────────────────────────── */

      .boot-loader__eyes {
        width: 160px;
        height: 80px;
      }

      .boot-loader__lid {
        transform: translateY(-56px);
      }

      .boot-loader__lid--left {
        animation: boot-lid-life 4s ease-in-out 0.4s infinite both;
      }

      .boot-loader__lid--right {
        animation: boot-lid-life 4s ease-in-out 0.7s infinite both;
      }

      @keyframes boot-lid-life {
        0%   { transform: translateY(-56px); }
        15%  { transform: translateY(0); }
        89%  { transform: translateY(0); }
        93%  { transform: translateY(-56px); }
        97%  { transform: translateY(0); }
        100% { transform: translateY(0); }
      }

      /* Pupil idle drift */
      .boot-loader__pupil--left {
        animation: boot-pupil-idle 3s ease-in-out 1.3s infinite;
      }

      .boot-loader__pupil--right {
        animation: boot-pupil-idle 3s ease-in-out 1.5s infinite;
      }

      @keyframes boot-pupil-idle {
        0%, 100% { transform: translate(0, 0); }
        20%      { transform: translate(2px, -1px); }
        50%      { transform: translate(-1.5px, 1px); }
        80%      { transform: translate(1px, -0.5px); }
      }

      /* Iris parallax drift */
      .boot-loader__iris--left {
        animation: boot-iris-idle 3s ease-in-out 1.3s infinite;
      }

      .boot-loader__iris--right {
        animation: boot-iris-idle 3s ease-in-out 1.5s infinite;
      }

      @keyframes boot-iris-idle {
        0%, 100% { transform: translate(0, 0); }
        20%      { transform: translate(1px, -0.5px); }
        50%      { transform: translate(-0.75px, 0.5px); }
        80%      { transform: translate(0.5px, -0.25px); }
      }

      /* Goggle rim glow pulse */
      .boot-loader__rim {
        animation: boot-goggle-glow 2s ease-in-out 1s infinite;
      }

      @keyframes boot-goggle-glow {
        0%, 100% { stroke: #9CA3AF; }
        50%      { stroke: #D1D5DB; }
      }

      /* Strap fade-in */
      .boot-loader__strap {
        opacity: 0;
        animation: boot-fade-in 0.4s ease-out 0.3s forwards;
      }

      .boot-loader__text {
        margin: 0;
        font-size: 14px;
        color: var(--color-text-secondary, #6b6b6b);
        opacity: 0;
        animation: boot-fade-in 0.5s ease-out 1.0s forwards;
      }

      @keyframes boot-fade-in {
        to { opacity: 1; }
      }

      :root[data-theme="light"] .boot-loader__text,
      :root[data-theme$="-light"] .boot-loader__text {
        color: var(--color-text-secondary, #8A7B50);
      }

      :root[data-theme="light"] .boot-loader__rim,
      :root[data-theme$="-light"] .boot-loader__rim {
        animation-name: boot-goggle-glow-light;
      }

      @keyframes boot-goggle-glow-light {
        0%, 100% { stroke: #6B7280; }
        50%      { stroke: #9CA3AF; }
      }

      :root[data-theme="light"] .boot-loader__strap,
      :root[data-theme$="-light"] .boot-loader__strap {
        fill: #9CA3AF;
      }

      :root[data-theme="light"] .boot-loader__pupil--left,
      :root[data-theme="light"] .boot-loader__pupil--right,
      :root[data-theme$="-light"] .boot-loader__pupil--left,
      :root[data-theme$="-light"] .boot-loader__pupil--right {
        fill: #1F2937;
      }

      @media (prefers-reduced-motion: reduce) {
        .boot-loader__lid {
          transform: translateY(0);
        }
        .boot-loader__lid--left,
        .boot-loader__lid--right,
        .boot-loader__pupil--left,
        .boot-loader__pupil--right,
        .boot-loader__iris--left,
        .boot-loader__iris--right,
        .boot-loader__rim,
        .boot-loader__strap,
        .boot-loader__text {
          animation: none !important;
          opacity: 1;
          transform: none;
        }
      }
    </style>
    <script>
      (function () {
        const THEME_KEY = "uiTheme";
        const VALID_THEMES = new Set(["light", "dark"]);

        const THEME_COLORS = {
          dark: "#0C0F1A",
          light: "#FFFCF0",
        };

        function getColorScheme(theme) {
          return theme === "light" ? "light" : "dark";
        }

        try {
          const stored = window.localStorage.getItem(THEME_KEY);
          let parsed = null;

          // Tolerate legacy values that were written as raw strings (not JSON).
          if (stored) {
            try {
              parsed = JSON.parse(stored);
            } catch {
              parsed = stored;
            }
          }

          const prefersLight = window.matchMedia
            ? window.matchMedia("(prefers-color-scheme: light)").matches
            : false;

          const fallbackTheme = prefersLight ? "light" : "dark";
          let theme = fallbackTheme;

          if (typeof parsed === "string") {
            if (VALID_THEMES.has(parsed)) {
              theme = parsed;
            } else if (parsed.endsWith("-light")) {
              theme = "light";
            } else if (parsed.endsWith("-dark")) {
              theme = "dark";
            }
          }

          const colorScheme = getColorScheme(theme);

          document.documentElement.dataset.theme = theme;
          document.documentElement.style.colorScheme = colorScheme;

          const metaThemeColor = document.querySelector('meta[name="theme-color"]');
          if (metaThemeColor) {
            metaThemeColor.setAttribute(
              "content",
              THEME_COLORS[theme] ?? THEME_COLORS[colorScheme] ?? "#0C0F1A"
            );
          }
        } catch (error) {
          console.warn("Failed to apply preferred theme early", error);
          document.documentElement.dataset.theme = "dark";
          document.documentElement.style.colorScheme = "dark";
        }
      })();
    </script>
  </head>
  <body>
    <div id="root">
      <div class="boot-loader" role="status" aria-live="polite" aria-busy="true">
        <div class="boot-loader__inner">
          <svg class="boot-loader__eyes" viewBox="0 0 200 100" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <radialGradient id="bl-lens" cx="40%" cy="35%" r="60%">
                <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0.15"/>
                <stop offset="100%" stop-color="#000000" stop-opacity="0"/>
              </radialGradient>
              <clipPath id="bl-lid-l">
                <rect class="boot-loader__lid boot-loader__lid--left" x="30" y="15" width="56" height="56" rx="28"/>
              </clipPath>
              <clipPath id="bl-lid-r">
                <rect class="boot-loader__lid boot-loader__lid--right" x="114" y="15" width="56" height="56" rx="28"/>
              </clipPath>
            </defs>
            <!-- Strap connecting goggles -->
            <rect class="boot-loader__strap" x="82" y="38" width="36" height="10" rx="2" fill="#6B7280"/>
            <!-- Left goggle -->
            <g>
              <circle class="boot-loader__rim" cx="58" cy="43" r="28" fill="none" stroke="#9CA3AF" stroke-width="4"/>
              <circle cx="58" cy="43" r="26" fill="none" stroke="#6B7280" stroke-width="1"/>
              <g clip-path="url(#bl-lid-l)">
                <circle cx="58" cy="43" r="22" fill="#F9FAFB"/>
                <circle class="boot-loader__iris boot-loader__iris--left" cx="58" cy="43" r="12" fill="#92700C"/>
                <circle class="boot-loader__pupil boot-loader__pupil--left" cx="58" cy="43" r="5.5" fill="#0C0F1A"/>
                <circle cx="58" cy="43" r="22" fill="url(#bl-lens)"/>
                <circle cx="52" cy="37" r="2.5" fill="#FFFFFF" opacity="0.7"/>
              </g>
            </g>
            <!-- Right goggle -->
            <g>
              <circle class="boot-loader__rim" cx="142" cy="43" r="28" fill="none" stroke="#9CA3AF" stroke-width="4"/>
              <circle cx="142" cy="43" r="26" fill="none" stroke="#6B7280" stroke-width="1"/>
              <g clip-path="url(#bl-lid-r)">
                <circle cx="142" cy="43" r="22" fill="#F9FAFB"/>
                <circle class="boot-loader__iris boot-loader__iris--right" cx="142" cy="43" r="12" fill="#92700C"/>
                <circle class="boot-loader__pupil boot-loader__pupil--right" cx="142" cy="43" r="5.5" fill="#0C0F1A"/>
                <circle cx="142" cy="43" r="22" fill="url(#bl-lens)"/>
                <circle cx="136" cy="37" r="2.5" fill="#FFFFFF" opacity="0.7"/>
              </g>
            </g>
          </svg>
          <p class="boot-loader__text">Loading minions...</p>
        </div>
      </div>
    </div>
    <script type="module" src="/src/browser/main.tsx"></script>
  </body>
</html>
